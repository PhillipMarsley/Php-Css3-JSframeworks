<!DOCTYPE html>

<html>

<head>
    <meta charset="UTF-8">
    <title>Javascript particles</title>
    <style>
        #container {
            width: 40em;
            height: 40em;
            border: 5px solid forestgreen;
            background: blanchedalmond;
        }

        #canvas {
            margin: 1em;
        }
    </style>
</head>

<body>
    <div id="container">
        <canvas id="canvas"></canvas>
    </div>

    <script>
        //============================================
        //  Declare Variables
        //============================================
        var container = document.getElementById("container"),
            canvas = document.getElementById("canvas"),
            canvasColor = "rgba(0, 0, 0, 1)",
            gc = canvas.getContext("2d"),
            fps = 1000 / 60,
            particleSize = 4,
            randDegrees = 0,
            randLife = 0,
            emitter;

        //============================================
        //  Helpers
        //============================================
        function getRandomIntInclusive(min, max) {
            min = Math.ceil(min);
            max = Math.floor(max);
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        function getRandomFloatInclusive(min, max) {
            return (Math.random() * (max - min)) + min;
        }

        //===========================================
        //  Objects
        //===========================================

        window.requestAnimFrame = (function () {
            return window.requestAnimationFrame ||
                window.webkitRequestAnimationFrame ||
                window.mozRequestAnimationFrame ||
                window.oRequestAnimationFrame ||
                window.msRequestAnimationFrame ||
                function (/* function */ callback, /* DOMElement */ element) {
                    window.setTimeout(callback, fps);
                };
        })();

        var canvasArea = {
            canvas: document.getElementById("canvas"),
            create: function () {
                this.canvas.width = container.clientWidth
                    - (container.offsetWidth - container.clientWidth)
                    - parseInt(window.getComputedStyle(this.canvas).marginRight)
                    - parseInt(window.getComputedStyle(container).borderRightWidth);
                this.canvas.height = container.clientHeight
                    - (container.offsetHeight - container.clientHeight)
                    - parseInt(window.getComputedStyle(this.canvas).marginBottom)
                    - parseInt(window.getComputedStyle(container).borderBottomWidth);
                this.context = this.canvas.getContext("2d");
            },
            clear: function () {
                gc.clearRect(0, 0, this.canvas.width, this.canvas.height);
            },
            paint: function () {
                gc.globalCompositeOperation = "source-over";
                gc.fillStyle = canvasColor;
                gc.fillRect(0, 0, this.canvas.width, this.canvas.height);
                gc.globalCompositeOperation = "lighter";
            }
        }

        function particle(x, y, life, angle, speed) {
            this.life = life;
            this.angleInRadians = angle * Math.PI / 180;
            this.xAngleAdd = getRandomIntInclusive(1, 4);
            this.yAngleAdd = getRandomIntInclusive(1, 4);
            this.position = {
                x: x,
                y: y
            };
            this.velocity = {
                x: speed * Math.cos(this.angleInRadians),
                y: -speed * Math.sin(this.angleInRadians)
            };
            this.update = function (deltaT) {
                this.life -= deltaT;

                if (this.life > 0) {
                    this.position.x += this.velocity.x * deltaT;
                    this.position.y += this.velocity.y * deltaT;

                    this.position.x *= Math.pow(1.001, this.xAngleAdd);
                    this.position.y *= Math.pow(1.001, this.yAngleAdd);
                }
            };
        }

        function emitter() {
            this.container = [];
            this.addparticles = function () {
                randDegrees = getRandomIntInclusive(-30, -60);
                randLife = getRandomIntInclusive(200, 255);
                //particle: x, y, life, degrees, speed
                this.container.unshift(new particle(10, 10, randLife, randDegrees, 2));
            }
            this.removeParticle = function (index) {
                this.container.splice(index, 1);
            }
            this.update = function (delta) {
                for (var i = this.container.length - 1; i >= 0; i--) {
                    this.container[i].update(delta);
                }
            }
            this.paint = function () {
                gc.fillStyle = "rgba(255, 100, 0, 0.5)";

                for (var i = this.container.length - 1; i >= 0; i--) {
                    var c = this.container[i],
                        x = c.position.x,
                        y = c.position.y;

                    gc.fillRect(x, y, particleSize, particleSize);
                }
            }
        }

        //===========================================
        //  Main Functions
        //===========================================


        function build() {
            emitter = new emitter();
        }

        function update() {
            for (var i = 0; i < 25; i++) {
                emitter.addparticles();
            }

            for (var i = emitter.container.length - 1; i >= 0; i--) {
                if (emitter.container[i].life <= 0) {
                    emitter.removeParticle(i);
                }
            }

            emitter.update(1);
        }

        function paint() {
            //canvas
            canvasArea.clear();
            canvasArea.color = "rgba(0, 0, 0, 1)";
            canvasArea.paint();

            emitter.paint();
        }

        function mainLoop() {
            requestAnimFrame(mainLoop);
            update();
            paint();
        }

        //===========================================
        //  Run
        //===========================================
        window.onload = function () {
            canvasArea.create();
            build();
            mainLoop();
        }
    </script>
</body>

</html>

<!--
        // function fireGradient(x, y, r, life) {
        //     var g = gc.createRadialGradient(x, y, r * 0.1, x, y, r * 1.1);
        //     g.addColorStop(0, "rgba(255, 255, 255, 1)");
        //     g.addColorStop(0.4, "rgba(255, 255," + (200 + life) + ", 1)");
        //     g.addColorStop(0.4, "rgba(255," + (100 + life) + ", 0, 1)");
        //     g.addColorStop(0.7, "rgba(255," + (10 + life) + ", 0, 1)");
        //     g.addColorStop(0.8, "rgba(255, 0, 0, 1)");
        //     g.addColorStop(1, "rgba(255, 0, 0, 1)");
        //     return g;
        // }

-->